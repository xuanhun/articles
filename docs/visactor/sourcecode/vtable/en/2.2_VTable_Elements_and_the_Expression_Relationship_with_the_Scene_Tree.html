<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2.2 VTable Elements and the Expression Relationship with the Scene Tree</title>
    <meta name="keywords" content="VisActor,VChart,VTable,VStrory,VMind,VGrammar,VRender,Visualization,Chart,Data,Table,Graph,Gis,LLM">
    <style>
        body {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
            line-height: 1.6;
            color: #24292e;
            background-color: #fff;
        }
        h1, h2, h3, h4, h5, h6 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
        }
        h1 { font-size: 2em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        h2 { font-size: 1.5em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        h3 { font-size: 1.25em; }
        code {
            padding: 0.2em 0.4em;
            margin: 0;
            font-size: 85%;
            background-color: rgba(27,31,35,0.05);
            border-radius: 3px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
        }
        pre {
            padding: 16px;
            overflow: auto;
            font-size: 85%;
            line-height: 1.45;
            background-color: #f6f8fa;
            border-radius: 6px;
        }
        pre code {
            background-color: transparent;
            padding: 0;
            font-size: 100%;
        }
        img {
            max-width: 100%;
            height: auto;
            box-sizing: content-box;
            background-color: #fff;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 16px 0;
            display: block;
            overflow: auto;
        }
        table th, table td {
            padding: 6px 13px;
            border: 1px solid #d0d7de;
        }
        table th {
            font-weight: 600;
            background-color: #f6f8fa;
        }
        table tr {
            background-color: #fff;
            border-top: 1px solid #d0d7de;
        }
        table tr:nth-child(2n) {
            background-color: #f6f8fa;
        }
        a {
            color: #0969da;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        blockquote {
            padding: 0 1em;
            color: #656d76;
            border-left: 0.25em solid #d0d7de;
            margin: 0 0 16px 0;
        }
        hr {
            height: 0.25em;
            padding: 0;
            margin: 24px 0;
            background-color: #d0d7de;
            border: 0;
        }
        ul, ol {
            padding-left: 2em;
        }
        li + li {
            margin-top: 0.25em;
        }
    </style>
</head>
<body>
    <p>What is the process from code to the vivid table presented to us in a VTable? My understanding is that VTable first creates a Table instance, then initializes each table element module by rendering the Canvas element. <strong>When initializing the element module, the SceneGraph creates the stage Stage and generates different types of basic scene tree node structure containers.</strong> Subsequently, the DataSet module processes the internal data of the table to generate different data structures according to different data display requirements. Additionally, with the assistance of other modules such as the Layout module and Event module, the table is endowed with neat layout and interactive features. After all preparations are completed, the rendering capability of the underlying VRender is called to render the abstract scene tree structure into a colorful table according to the blueprint of the Stage we mentioned earlier.</p>
<p><img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/DHefbI3iZo1kW7xb4COc1Mnjn7b.gif' alt='' width='1000' height='auto'></p>
<p>This article explains the process of initializing the table container in the scene tree;    \r</p>
<h2 id="relevant-source-code-location">Relevant Source Code Location</h2>
<ul>
<li>
<p>package/vtable/src/scenegrapg/groupcreater/init-scenegraph.ts Initialization of the scene graph container    \r</p>
</li>
<li>
<p>package/vtable/src/core/BaseTable.ts Definition file of the scene tree core class    </p>
</li>
<li>
<p>package/vtable/src/scenegraph/grapghic/group.ts is the Group class for table rendering extension, used to control the layout, size, and rendering of the table. The final returned instance is a group object in the table, which can be a cell group, header group, frozen column group, etc. \r</p>
</li>
</ul>
<h2 id="initialization-process">Initialization Process</h2>
<h3 id="initialization-of-the-root-node">Initialization of the Root Node</h3>
<pre class="codehilite"><code class="language-xml"> scene.tableGroup = new Group({
      x: 0, 
      y: 0,
      width,
      height,
      clip: true, pickable: false 
  });
  scene.tableGroup.role = 'table';    
</code></pre>

<blockquote>
<p><img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/ZFN6boBuBo7lljxdpU0cGTH5ndc.gif' alt='' width='1000' height='auto'>
<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/RprMb1GIToX8e4xCoz0cvfcanjb.gif' alt='' width='1000' height='auto'>
Here is the VRender documentation regarding the Group class, explaining the two properties: clip and pickable. When creating a Group, coordinates, dimensions, and these two properties will be configured.</p>
</blockquote>
<p>pickable: Whether the primitive can be interactive. If false, it will not respond to any events (only display, no interaction)    \r</p>
<p>clip: After setting the group to clip, it will crop the parts of child elements that exceed the range based on width and height (similar to overflow: hidden)    \r</p>
<h3 id="initialization-of-the-remaining-nodes-in-the-scene-tree">Initialization of the Remaining Nodes in the Scene Tree</h3>
<pre class="codehilite"><code class="language-xml">function initSceneGraph(scene: Scenegraph) {
  const width = scene.table.tableNoFrameWidth;
  const height = scene.table.tableNoFrameHeight;

  // 根容器
  scene.tableGroup = new Group({ x: 0, y: 0, width, height, clip: true });

  // 创建各子容器的Group实例
  const colHeaderGroup = createContainerGroup(
    0,
    0,
    !(scene.table.options as ListTableConstructorOptions).enableTreeStickCell
  );

  //设置colHeader的role属性为'col-header'
  colHeaderGroup.role = 'col-header';
  scene.colHeaderGroup = colHeaderGroup;
}
</code></pre>

<blockquote>
<p>Here, the creation source code of ColHeaderGroup is used as an example    </p>
</blockquote>
<hr />
<pre class="codehilite"><code class="language-xml">function createContainerGroup(width: number, height: number, clip?: boolean) {
  return new Group({
    x: 0,
    y: 0,
    width,
    height,
    clip: clip ?? false,
    pickable: false
  });
}
</code></pre>

<blockquote>
<p>The process of createContainerGroup returning a Group instance    </p>
</blockquote>
<h3 id="add-to-root-node">Add to Root Node</h3>
<pre class="codehilite"><code class="language-xml">scene.tableGroup.addChild(bodyGroup);
scene.tableGroup.addChild(rowHeaderGroup);
scene.tableGroup.addChild(bottomFrozenGroup);
//...
//其余节点类似    
</code></pre>

<p>Add the generated different nodes to the root node in sequence, indicating in the source code comments that different addition orders may have a certain impact;    \r</p>
<h2 id="summary">Summary</h2>
<p>In the scenegraph class, when initializing the scene tree, the current Scenegraph instance is passed into the initSceneGraph function (from /init-scenegraph.ts). It is not difficult to see from initSceneGraph that different types of table subunits return a Group instance through <code>createContainerGroup</code> while creating the scene tree, and then set the <code>role</code> attribute on the instance to identify its function, finally adding them to the root container <code>TableGroup</code> respectively.</p>
<p>At this point, the initialization part of the container is complete, and container nodes (Group) of different types of elements in the scene tree have been generated.</p>
<h1 id="this-document-was-revised-and-organized-by-the-following-personnel">This document was revised and organized by the following personnel</h1>
<p><a href="https://github.com/xuanhun">玄魂</a></p>
</body>
</html>