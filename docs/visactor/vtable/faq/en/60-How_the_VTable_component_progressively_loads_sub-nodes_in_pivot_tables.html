<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How the VTable component progressively loads sub-nodes in pivot tables</br></title>
    <meta name="keywords" content="VisActor,VChart,VTable,VStrory,VMind,VGrammar,VRender,Visualization,Chart,Data,Table,Graph,Gis,LLM">
    <style>
        body {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
            line-height: 1.6;
            color: #24292e;
            background-color: #fff;
        }
        h1, h2, h3, h4, h5, h6 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
        }
        h1 { font-size: 2em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        h2 { font-size: 1.5em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        h3 { font-size: 1.25em; }
        code {
            padding: 0.2em 0.4em;
            margin: 0;
            font-size: 85%;
            background-color: rgba(27,31,35,0.05);
            border-radius: 3px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
        }
        pre {
            padding: 16px;
            overflow: auto;
            font-size: 85%;
            line-height: 1.45;
            background-color: #f6f8fa;
            border-radius: 6px;
        }
        pre code {
            background-color: transparent;
            padding: 0;
            font-size: 100%;
        }
        img {
            max-width: 100%;
            height: auto;
            box-sizing: content-box;
            background-color: #fff;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 16px 0;
            display: block;
            overflow: auto;
        }
        table th, table td {
            padding: 6px 13px;
            border: 1px solid #d0d7de;
        }
        table th {
            font-weight: 600;
            background-color: #f6f8fa;
        }
        table tr {
            background-color: #fff;
            border-top: 1px solid #d0d7de;
        }
        table tr:nth-child(2n) {
            background-color: #f6f8fa;
        }
        a {
            color: #0969da;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        blockquote {
            padding: 0 1em;
            color: #656d76;
            border-left: 0.25em solid #d0d7de;
            margin: 0 0 16px 0;
        }
        hr {
            height: 0.25em;
            padding: 0;
            margin: 24px 0;
            background-color: #d0d7de;
            border: 0;
        }
        ul, ol {
            padding-left: 2em;
        }
        li + li {
            margin-top: 0.25em;
        }
    </style>
</head>
<body>
    <h2 id="question-title">Question title</h2>
<p>How to progressively load sub-nodes in a pivot table using the VTable component?</br></p>
<h2 id="problem-description">Problem description</h2>
<p>Using the VTable table component, how to gradually load sub-nodes in the pivot table, click the expand button of the parent node, and then dynamically load the information of the sub-node</br></p>
<h2 id="solution">Solution</h2>
<p>VTable provides <code>setTreeNodeChildren</code>API, which is used to update the sub-node status of a node in the pivot structure and can be used to implement progressive loading function</br>
1. Dimension tree configuration</br>
Normally, in the dimension tree (columnTree/rowTree), the <code>children</code>attribute is an array, which is the sub-node information of the node</br></p>
<pre class="codehilite"><code>{
    dimensionKey: 'name',
    value: 'a',
    children: [
        {
            dimensionKey: 'name-1',
            value: 'a-1',
            children: [
                // ......
            ]
        },
        // ......
    ]
}&lt;/br&gt;
</code></pre>

<p>How to dynamically load sub-node information, you can configure the <code>children</code>property to <code>true</code>. At this time, the node will be displayed as the parent node in the table, but clicking the expand button in the cell will trigger relevant events, but the table will not have any active changes.</br>
1. Monitoring events</br>
After the expand button is clicked, the <code>VTable. ListTable.EVENT_TYPE</code>event will be triggered. You need to listen to this event and use the <code>setTreeNodeChildren</code>API to update the sub-node information and the corresponding increased data</br></p>
<pre class="codehilite"><code>const { TREE_HIERARCHY_STATE_CHANGE } = VTable.ListTable.EVENT_TYPE;
instance.on(TREE_HIERARCHY_STATE_CHANGE, args =&gt; {
  if (args.hierarchyState === VTable.TYPES.HierarchyState.expand &amp;&amp; !Array.isArray(args.originData.children)) {
    setTimeout(() =&gt; {
      const newData = [
        // ......
      ];
      const children = [
        {
          dimensionKey: 'name-1',
          value: 'a-1',
        },
        {
          dimensionKey: 'name-1',
          value: 'a-2'
        }
      ];
      instance.setTreeNodeChildren(children, newData, args.col, args.row);
    }, 200);
  }
});&lt;/br&gt;
</code></pre>

<h2 id="code-example">Code example</h2>
<p>demo：https://visactor.io/vtable/demo/table-type/pivot-table-tree-lazy-load</br></p>
<h2 id="related-documents">Related Documents</h2>
<p>Related api: https://visactor.io/vtable/option/PivotTable#rowHierarchyType ('grid'% 20% 7C% 20'tree ')</br>
Tutorial: https://visactor.io/vtable/guide/table_type/Pivot_table/pivot_table_tree</br>
github：https://github.com/VisActor/VTable</br></p>
</body>
</html>